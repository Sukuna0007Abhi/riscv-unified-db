# Copyright (c) Qualcomm Technologies, Inc. and/or its subsidiaries.
# SPDX-License-Identifier: BSD-3-Clause-Clear

# yaml-language-server: $schema=../../../../schemas/csr_schema.json

$schema: "csr_schema.json#"
kind: csr
name: hvip
long_name: Hypervisor Virtual Interrupt Pending
address: 0x645
writable: true
priv_mode: M
length: 64
definedBy: H
description: |
  The `hvip` CSR allows hypervisors to inject virtual supervisor interrupts.
  Bits set in this register will be reflected in the corresponding `hip` and `mip` fields,
  making them visible to the virtual machine.

  This register provides the mechanism for hypervisors to inject software and timer interrupts
  into virtual machines without requiring hardware-level interrupt controllers.

fields:
  VSSIP:
    location: 2
    description: |
      *Virtual Supervisor Software Interrupt Pending*

      When set by the hypervisor, causes a virtual supervisor software interrupt to be pending in the virtual machine.

      This bit is aliased in `hip.VSSIP` and `mip.VSSIP`.
    type: RW
    reset_value: 0
    definedBy: H
  VSTIP:
    location: 6
    description: |
      *Virtual Supervisor Timer Interrupt Pending*

      When set by the hypervisor, causes a virtual supervisor timer interrupt to be pending in the virtual machine.

      <%- if ext?(:Sstc) -%>
      When the Sstc extension is enabled (`menvcfg.STCE` and `henvcfg.STCE` are set), the actual interrupt pending state (`mip.VSTIP`) is the logical OR of this field and the timer-generated interrupt (controlled by `vstimecmp`).
      
      When Sstc is disabled, `mip.VSTIP` reflects exactly the value of this field.
      <%- else -%>
      This bit directly controls the virtual supervisor timer interrupt pending state.
      <%- end -%>

      This bit is reflected in `hip.VSTIP` and `mip.VSTIP`.
    type: RW
    reset_value: 0
    definedBy: H
    affectedBy: Sstc
  VSEIP:
    location: 10
    description: |
      *Virtual Supervisor External Interrupt Pending*

      When set by the hypervisor, causes a virtual supervisor external interrupt to be pending in the virtual machine.

      The actual interrupt pending state (`mip.VSEIP`) is the logical OR of this field and the signal from the external interrupt controller.

      This bit is reflected in `hip.VSEIP` and `mip.VSEIP`.
    type: RW
    reset_value: 0
    definedBy: H